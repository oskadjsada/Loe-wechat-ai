#å•†ä¸šç‰ˆæœ¬æ”¯æŒ2.0å¾®ä¿¡æœ¬åœ°ç›´æ¥è®­ç»ƒ
æœªç»æœ¬äººæˆæƒç¦æ­¢å‡ºå–ï¼Œåªå…¬å¼€å­¦ä¹ 
å•†ä¸šç‰ˆæœ¬2.0æ”¯æŒåˆ¶å®šåŒ–ï¼Œå¾®ä¿¡å¯¹è¯æ¡†ç›´æ¥è®­ç»ƒ
åŒ…ä¼˜åŒ–ï¼ŒåŒ…æœåŠ¡è®­ç»ƒã€æœ¬äººå¾®ä¿¡ï¼š3484733722ã€‘
ã€ğŸ’¡å…³æ³¨å…¬ä¼—å·ï¼šå°å³°ç§‘æŠ€ç½‘ç»œğŸ’¡ã€‘
[æ³¨æ„:æœåŠ¡å™¨ä½¿ç”¨é˜¿é‡Œäº‘çš„ECSé€‰æ‹©é¦™æ¸¯æœåŠ¡å™¨]
![7c8576aaea0a5965ca49b71a07a3cbc](https://github.com/user-attachments/assets/18e7082f-f7c2-4e9f-bbd1-89268407d5c5)
# WeChat AI åŠ©æ‰‹

è¿™æ˜¯ä¸€ä¸ªåŸºäºå¾®ä¿¡å…¬ä¼—å·çš„AIåŠ©æ‰‹é¡¹ç›®ï¼Œä½¿ç”¨Pythonå¼€å‘ï¼Œæ”¯æŒä¸ç”¨æˆ·è¿›è¡Œæ™ºèƒ½å¯¹è¯ã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- æ”¯æŒå¾®ä¿¡å…¬ä¼—å·æ¶ˆæ¯æ¥æ”¶å’Œå›å¤
- é›†æˆDeepSeek AIæ¨¡å‹è¿›è¡Œæ™ºèƒ½å¯¹è¯
- æ”¯æŒé•¿æ¶ˆæ¯è‡ªåŠ¨åˆ†æ®µå‘é€
- æ”¯æŒä¸“ä¸šé¢†åŸŸï¼ˆå¦‚ç½‘ç»œå®‰å…¨ï¼‰çš„ä¸“ä¸šå›ç­”
- æ”¯æŒè‡ªç”±å¯¹è¯æ¨¡å¼
- å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

## ç³»ç»Ÿæ•°å­¦æ¶æ„

æœ¬ç³»ç»Ÿçš„æ•°å­¦æ¶æ„å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªç»´åº¦æè¿°ï¼š

### 1. æ¶ˆæ¯å¤„ç†æ˜ å°„å‡½æ•°

ç³»ç»Ÿå¤„ç†æ¶ˆæ¯çš„æµç¨‹å¯è¡¨ç¤ºä¸ºæ˜ å°„å‡½æ•° $f: M \rightarrow R$ï¼Œå…¶ä¸­ï¼š
- $M$ è¡¨ç¤ºæ¶ˆæ¯ç©ºé—´ï¼ŒåŒ…å«ç”¨æˆ·å‘é€çš„å„ç±»æ¶ˆæ¯ $m \in M$
- $R$ è¡¨ç¤ºå“åº”ç©ºé—´ï¼ŒåŒ…å«ç³»ç»Ÿå¯èƒ½çš„å“åº” $r \in R$

å¯¹äºæ–‡æœ¬æ¶ˆæ¯å¤„ç†ï¼š
$$f_\text{text}(m) = g(h(m, c))$$

å…¶ä¸­ï¼š
- $h: M \times C \rightarrow Q$ æ˜¯ä¸Šä¸‹æ–‡åˆå¹¶å‡½æ•°ï¼Œå°†æ¶ˆæ¯ $m$ ä¸ä¼šè¯ä¸Šä¸‹æ–‡ $c \in C$ åˆå¹¶
- $g: Q \rightarrow R$ æ˜¯AIæ¨ç†å‡½æ•°ï¼Œå°†æŸ¥è¯¢ $q \in Q$ æ˜ å°„åˆ°å“åº” $r$

æ¶ˆæ¯ç©ºé—´å¯è¿›ä¸€æ­¥åˆ†è§£ä¸ºï¼š
$$M = M_\text{text} \cup M_\text{voice} \cup M_\text{event}$$

æ¯ç§æ¶ˆæ¯ç±»å‹æ˜ å°„åˆ°ä¸åŒçš„å¤„ç†å‡½æ•°ï¼š
$$
\begin{cases}
f_\text{text}: M_\text{text} \rightarrow R_\text{text} \\
f_\text{voice}: M_\text{voice} \rightarrow R_\text{text} \\
f_\text{event}: M_\text{event} \rightarrow R_\text{event}
\end{cases}
$$

### 2. ä¼šè¯çŠ¶æ€è½¬æ¢

ä¼šè¯çŠ¶æ€å¯ä»¥è¡¨ç¤ºä¸ºæœ‰é™çŠ¶æ€æœºï¼š
$$S_{t+1} = \delta(S_t, m_t)$$

å…¶ä¸­ï¼š
- $S_t$ æ˜¯æ—¶é—´ $t$ çš„ä¼šè¯çŠ¶æ€ï¼ŒåŒ…å«å†å²æ¶ˆæ¯åºåˆ—
- $m_t$ æ˜¯æ—¶é—´ $t$ çš„ç”¨æˆ·è¾“å…¥
- $\delta$ æ˜¯çŠ¶æ€è½¬æ¢å‡½æ•°

ä¼šè¯çŠ¶æ€ $S_t$ å¯ä»¥è¡¨ç¤ºä¸ºæ¶ˆæ¯åºåˆ—ï¼š
$$S_t = \{m_0, r_0, m_1, r_1, ..., m_{t-1}, r_{t-1}\}$$

å…¶ä¸­ $m_i$ æ˜¯ç”¨æˆ·æ¶ˆæ¯ï¼Œ$r_i$ æ˜¯ç³»ç»Ÿå“åº”ã€‚

ä¼šè¯ä¿®å‰ªç®—æ³•å¯ä»¥è¡¨ç¤ºä¸ºï¼š
$$S'_t = \phi(S_t, \tau)$$

å…¶ä¸­ï¼š
- $\phi$ æ˜¯ä¿®å‰ªå‡½æ•°
- $\tau$ æ˜¯tokenæ•°é‡é˜ˆå€¼ï¼ˆæœ¬ç³»ç»Ÿä¸­ä¸º $\tau = 1000$ï¼‰
- $S'_t$ æ˜¯ä¿®å‰ªåçš„ä¼šè¯çŠ¶æ€

å…·ä½“çš„ä¿®å‰ªå‡½æ•°å®ç°ä¸ºï¼š
$$\phi(S_t, \tau) = 
\begin{cases}
S_t, & \text{å¦‚æœ} \sum_{i=0}^{t-1} (|m_i| + |r_i|) \cdot \alpha \leq \tau \\
\{m_0, r_0\} \cup \{m_{t-k}, r_{t-k}, ..., m_{t-1}, r_{t-1}\}, & \text{å¦åˆ™}
\end{cases}$$

å…¶ä¸­ï¼š
- $|m_i|$ å’Œ $|r_i|$ æ˜¯æ¶ˆæ¯çš„å­—ç¬¦é•¿åº¦
- $\alpha$ æ˜¯å­—ç¬¦åˆ°tokençš„è½¬æ¢ç³»æ•°ï¼ˆçº¦0.7ï¼‰
- $k$ æ˜¯ä¿ç•™çš„æœ€è¿‘æ¶ˆæ¯æ•°é‡ï¼Œä½¿å¾— $\sum_{i=t-k}^{t-1} (|m_i| + |r_i|) \cdot \alpha \leq \tau$

### 3. AIå“åº”ç”Ÿæˆ

AIå“åº”ç”Ÿæˆè¿‡ç¨‹å¯ä»¥è¡¨ç¤ºä¸ºæ¡ä»¶æ¦‚ç‡æœ€å¤§åŒ–é—®é¢˜ï¼š
$$r^* = \arg\max_{r \in R} P(r|q, \theta)$$

å…¶ä¸­ï¼š
- $q$ æ˜¯åŒ…å«ä¸Šä¸‹æ–‡çš„æŸ¥è¯¢
- $\theta$ æ˜¯æ¨¡å‹å‚æ•°ï¼ˆDeepSeek-R1æ¨¡å‹ï¼‰
- $r^*$ æ˜¯æœ€ä¼˜å“åº”

åœ¨DeepSeekæ¨¡å‹ä¸­ï¼Œæ¡ä»¶æ¦‚ç‡é€šè¿‡è‡ªå›å½’æ–¹å¼è®¡ç®—ï¼š
$$P(r|q,\theta) = \prod_{i=1}^{n} P(r_i|q,r_1,...,r_{i-1},\theta)$$

å…¶ä¸­ï¼Œ$r_i$ æ˜¯å“åº”ä¸­çš„ç¬¬ $i$ ä¸ªtokenã€‚

åœ¨å®é™…è®¡ç®—ä¸­ï¼Œä½¿ç”¨ä»¥ä¸‹å‚æ•°å½±å“ç”Ÿæˆï¼š
- æ¸©åº¦ç³»æ•° $T = 0.7$ï¼Œæ§åˆ¶éšæœºæ€§
- é‡‡æ ·æ¦‚ç‡é˜ˆå€¼ $p_{top} = 0.95$ï¼Œè¿‡æ»¤ä½æ¦‚ç‡token
- æœ€å¤§ç”Ÿæˆtokenæ•° $n_{max} = 2000$

é¢„æµ‹è¿‡ç¨‹å¯æè¿°ä¸ºï¼š
$$r_i \sim \text{softmax}\left(\frac{f_\theta(q,r_1,...,r_{i-1})}{T}\right)$$

å…¶ä¸­ $f_\theta$ æ˜¯ç¥ç»ç½‘ç»œè¾“å‡ºçš„logitsã€‚

### 4. è¯·æ±‚è¶…æ—¶è®¡ç®—

ç³»ç»Ÿä½¿ç”¨åŠ¨æ€è¶…æ—¶è®¡ç®—å‡½æ•°ï¼š
$$T(m) = T_\text{base} + \min(30, \lfloor \frac{\max(0, |m| - 200)}{100} \rfloor \cdot 5)$$

å…¶ä¸­ï¼š
- $T_\text{base}$ æ˜¯åŸºç¡€è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤60ç§’ï¼‰
- $|m|$ æ˜¯æ¶ˆæ¯é•¿åº¦

è¿™å¯è¿›ä¸€æ­¥è¡¨ç¤ºä¸ºåˆ†æ®µå‡½æ•°ï¼š
$$T(m) = 
\begin{cases}
T_\text{base}, & \text{å¦‚æœ } |m| \leq 200 \\
T_\text{base} + \min(30, \lfloor \frac{|m| - 200}{100} \rfloor \cdot 5), & \text{å¦‚æœ } |m| > 200
\end{cases}$$

åœ¨ç³»ç»Ÿå®ç°ä¸­ï¼Œè¶…æ—¶ä¸å“åº”è´¨é‡çš„å…³ç³»å¯è¡¨ç¤ºä¸ºï¼š
$$Q(r) \propto \min(Q_{max}, \log(T(m)))$$

å…¶ä¸­ $Q(r)$ è¡¨ç¤ºå“åº”è´¨é‡ï¼Œ$Q_{max}$ æ˜¯è´¨é‡ä¸Šé™ã€‚

### 5. é‡è¯•æœºåˆ¶

ç³»ç»Ÿä½¿ç”¨æŒ‡æ•°é€€é¿ç­–ç•¥è¿›è¡Œé‡è¯•ï¼š
$$t_\text{wait}(n) = 2n$$

å…¶ä¸­ï¼š
- $n$ æ˜¯å½“å‰é‡è¯•æ¬¡æ•°
- $t_\text{wait}$ æ˜¯ç­‰å¾…æ—¶é—´ï¼ˆç§’ï¼‰

é‡è¯•æ¦‚ç‡ç©ºé—´å»ºæ¨¡ï¼š
è®¾ $P_s(n)$ æ˜¯ç¬¬ $n$ æ¬¡å°è¯•æˆåŠŸçš„æ¦‚ç‡ï¼Œåˆ™æ€»æˆåŠŸæ¦‚ç‡ä¸ºï¼š
$$P_{æ€»} = 1 - \prod_{i=0}^{N_{max}}(1 - P_s(i))$$

å…¶ä¸­ $N_{max}$ æ˜¯æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆç³»ç»Ÿä¸­ä¸º2ï¼‰ã€‚

å‡è®¾æ¯æ¬¡å°è¯•çš„æˆåŠŸæ¦‚ç‡ä¸ºå¸¸æ•° $p$ï¼Œåˆ™ï¼š
$$P_{æ€»} = 1 - (1-p)^{N_{max}+1}$$

### 6. æ¶ˆæ¯åˆ†æ®µç®—æ³•

é•¿æ¶ˆæ¯è‡ªåŠ¨åˆ†æ®µç®—æ³•å¯ä»¥è¡¨è¿°ä¸ºåˆ†ç‰‡å‡½æ•° $\Psi: R \rightarrow R^k$ï¼š
$$\Psi(r) = (r^{(1)}, r^{(2)}, ..., r^{(k)})$$

å…¶ä¸­ï¼š
- $r$ æ˜¯åŸå§‹å“åº”
- $r^{(i)}$ æ˜¯ç¬¬ $i$ ä¸ªåˆ†æ®µ
- $k$ æ˜¯åˆ†æ®µæ•°é‡

åˆ†æ®µè¿‡ç¨‹æ»¡è¶³ï¼š
1. é•¿åº¦çº¦æŸï¼š$\forall i, |r^{(i)}| \leq L_{max}$ï¼Œå…¶ä¸­ $L_{max}$ æ˜¯å•æ¡æ¶ˆæ¯æœ€å¤§é•¿åº¦ï¼ˆ2000å­—ï¼‰
2. å®Œæ•´æ€§çº¦æŸï¼š$r = r^{(1)} \oplus r^{(2)} \oplus ... \oplus r^{(k)}$ï¼Œå…¶ä¸­ $\oplus$ æ˜¯å­—ç¬¦ä¸²è¿æ¥æ“ä½œ
3. è¾¹ç•Œçº¦æŸï¼šåˆ†æ®µåº”åœ¨è‡ªç„¶æ–­å¥å¤„ï¼Œå¯¹äºåˆ†æ®µç‚¹ $b_i$ï¼Œä¼˜å…ˆé€‰æ‹© $r[b_i] \in \{ã€‚, ï¼, ï¼Ÿ, ., !, ?\}$

### 7. å¹¶å‘è¯·æ±‚å¤„ç†æ¨¡å‹

å¹¶å‘å¤„ç†å¯ä»¥ç”¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹æè¿°ï¼š
$$Q_t = Q_{t-1} \cup P_t - C_t$$

å…¶ä¸­ï¼š
- $Q_t$ æ˜¯æ—¶é—´ $t$ çš„è¯·æ±‚é˜Ÿåˆ—
- $P_t$ æ˜¯æ—¶é—´ $t$ çš„æ–°å¢è¯·æ±‚é›†
- $C_t$ æ˜¯æ—¶é—´ $t$ å¤„ç†å®Œæˆçš„è¯·æ±‚é›†

ç³»ç»Ÿçº¿ç¨‹æ¨¡å‹å¯è¡¨ç¤ºä¸ºï¼š
$$T = \{T_{main}, T_{http}, T_{worker_1}, ..., T_{worker_n}\}$$

å…¶ä¸­å„çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥ä½¿ç”¨äº’æ–¥é” $\mu$ å’Œæ¡ä»¶å˜é‡ $cv$ å®ç°ï¼š
$$\begin{align}
acquire(\mu) &: \text{è·å–é”} \\
release(\mu) &: \text{é‡Šæ”¾é”} \\
wait(cv, \mu) &: \text{ç­‰å¾…æ¡ä»¶å˜é‡ï¼ŒåŒæ—¶é‡Šæ”¾é”} \\
notify(cv) &: \text{å”¤é†’ç­‰å¾…è¯¥æ¡ä»¶çš„ä¸€ä¸ªçº¿ç¨‹}
\end{align}$$

### 8. çŸ©é˜µå˜æ¢ä¸åµŒå…¥è¡¨ç¤º

åœ¨DeepSeekæ¨¡å‹ä¸­ï¼Œæ¶ˆæ¯åºåˆ—é¦–å…ˆè½¬æ¢ä¸ºtokenåºåˆ—ï¼Œç„¶ååµŒå…¥ä¸ºé«˜ç»´å‘é‡ï¼š
$$\mathbf{E} = \text{Embedding}(\text{Tokenize}(m)) \in \mathbb{R}^{L \times d}$$

å…¶ä¸­ï¼š
- $L$ æ˜¯åºåˆ—é•¿åº¦
- $d$ æ˜¯åµŒå…¥ç»´åº¦ï¼ˆé€šå¸¸ä¸º4096ï¼‰

è‡ªæ³¨æ„åŠ›æœºåˆ¶è®¡ç®—å…¬å¼ï¼š
$$\text{Attention}(\mathbf{Q}, \mathbf{K}, \mathbf{V}) = \text{softmax}\left(\frac{\mathbf{Q}\mathbf{K}^T}{\sqrt{d_k}}\right)\mathbf{V}$$

å…¶ä¸­ $\mathbf{Q}, \mathbf{K}, \mathbf{V} \in \mathbb{R}^{L \times d}$ æ˜¯æŸ¥è¯¢ã€é”®ã€å€¼çŸ©é˜µã€‚

å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶ï¼š
$$\text{MultiHead}(\mathbf{X}) = \text{Concat}(\text{head}_1, ..., \text{head}_h)\mathbf{W}^O$$

å…¶ä¸­ï¼š
$$\text{head}_i = \text{Attention}(\mathbf{X}\mathbf{W}_i^Q, \mathbf{X}\mathbf{W}_i^K, \mathbf{X}\mathbf{W}_i^V)$$

### 9. ç³»ç»Ÿæ€§èƒ½ä¸èµ„æºåˆ†æ

ç³»ç»Ÿæ€§èƒ½å¯ä»¥ç”¨å“åº”æ—¶é—´åˆ†å¸ƒå»ºæ¨¡ï¼š
$$T_{resp} = T_{queue} + T_{process} + T_{api} + T_{send}$$

å…¶ä¸­å„éƒ¨åˆ†çš„ç»Ÿè®¡ç‰¹æ€§å¯ä»¥ç”¨æ¦‚ç‡åˆ†å¸ƒè¡¨ç¤ºï¼š
- $T_{queue} \sim \text{Exp}(\lambda_q)$ï¼šé˜Ÿåˆ—ç­‰å¾…æ—¶é—´æœä»æŒ‡æ•°åˆ†å¸ƒ
- $T_{process} \sim \mathcal{N}(\mu_p, \sigma_p^2)$ï¼šå¤„ç†æ—¶é—´æœä»æ­£æ€åˆ†å¸ƒ
- $T_{api} \sim \text{LogNormal}(\mu_a, \sigma_a^2)$ï¼šAPIè°ƒç”¨æ—¶é—´æœä»å¯¹æ•°æ­£æ€åˆ†å¸ƒ
- $T_{send} \sim \text{Exp}(\lambda_s)$ï¼šå‘é€æ—¶é—´æœä»æŒ‡æ•°åˆ†å¸ƒ

ç³»ç»Ÿèµ„æºä½¿ç”¨æ¨¡å‹ï¼š
$$\begin{align}
\text{CPU}_t &= \alpha_c \cdot N_{req/s} + \beta_c \\
\text{MEM}_t &= \alpha_m \cdot N_{active} + \beta_m
\end{align}$$

å…¶ä¸­ï¼š
- $N_{req/s}$ æ˜¯æ¯ç§’è¯·æ±‚æ•°
- $N_{active}$ æ˜¯æ´»è·ƒä¼šè¯æ•°
- $\alpha_c, \beta_c, \alpha_m, \beta_m$ æ˜¯ç³»ç»Ÿç‰¹å®šå¸¸æ•°

## å¼€å‘ç¯å¢ƒä¸æŠ€æœ¯æ ˆ

æœ¬é¡¹ç›®åŸºäºä»¥ä¸‹æŠ€æœ¯æ ˆå¼€å‘ï¼š

- **ç¼–ç¨‹è¯­è¨€**: Python 3.8+
- **webæ¡†æ¶**: åŸç”ŸHTTPæœåŠ¡å™¨ï¼ˆhttp.serverï¼‰
- **AIæ¨¡å‹**: DeepSeek-R1ï¼ˆé€šè¿‡APIè°ƒç”¨ï¼‰
- **å›¾åƒå¤„ç†**: Pillowåº“
- **ç³»ç»Ÿé›†æˆ**: Windows/Linuxç³»ç»ŸAPI
- **æ‰“åŒ…å·¥å…·**: PyInstaller

## ç³»ç»Ÿè¦æ±‚

- Python 3.8+
- Windows 10/11 æˆ– Linux ç³»ç»Ÿï¼ˆCentOS 7+/Ubuntu 18.04+ï¼‰
- å¾®ä¿¡å…¬ä¼—å·å¼€å‘è€…è´¦å·
- å…¬ç½‘IPæˆ–åŸŸåï¼ˆç”¨äºå¾®ä¿¡æœåŠ¡å™¨å›è°ƒï¼‰
- æœ€å°é…ç½®ï¼š1æ ¸CPUï¼Œ1GBå†…å­˜ï¼Œ10GBå­˜å‚¨ç©ºé—´

## å®‰è£…æ­¥éª¤

1. å…‹éš†é¡¹ç›®åˆ°æœ¬åœ°ï¼š
```bash
git clone [é¡¹ç›®åœ°å€]
cd wehcat
```

2. å®‰è£…ä¾èµ–åŒ…ï¼š
```bash
pip install -r requirements.txt
```

3. é…ç½®å¾®ä¿¡å…¬ä¼—å·ï¼š
   - ç™»å½•å¾®ä¿¡å…¬ä¼—å¹³å°
   - è·å–AppIDå’ŒAppSecret
   - é…ç½®æœåŠ¡å™¨åœ°å€å’ŒToken
   - é…ç½®æ¶ˆæ¯åŠ è§£å¯†å¯†é’¥

4. ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š
   - æ‰“å¼€ `config.json`
   - å¡«å…¥æ‚¨çš„å¾®ä¿¡å…¬ä¼—å·é…ç½®ä¿¡æ¯
   - é…ç½®AIæ¨¡å‹å‚æ•°

## å¾®ä¿¡å…¬ä¼—å·é…ç½®è¯¦è§£

### 1. ç”³è¯·å¾®ä¿¡å…¬ä¼—å·

1. è®¿é—®[å¾®ä¿¡å…¬ä¼—å¹³å°](https://mp.weixin.qq.com/)æ³¨å†Œè´¦å·
2. é€‰æ‹©"æœåŠ¡å·"ç±»å‹ï¼ˆæ¨èï¼ŒåŠŸèƒ½æ›´å®Œæ•´ï¼‰
3. å®Œæˆä¼ä¸šèµ„è´¨è®¤è¯ï¼ˆä¸ªäººå¯é€‰æ‹©è®¢é˜…å·ï¼‰

### 2. é…ç½®æœåŠ¡å™¨

1. ç™»å½•å¾®ä¿¡å…¬ä¼—å¹³å°ï¼Œè¿›å…¥"è®¾ç½®ä¸å¼€å‘" â†’ "åŸºæœ¬é…ç½®"
2. åœ¨"æœåŠ¡å™¨é…ç½®"éƒ¨åˆ†ï¼Œå¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼š
   - **æœåŠ¡å™¨åœ°å€(URL)**: `http://æ‚¨çš„åŸŸåæˆ–IP/wechat`ï¼ˆå¿…é¡»æ˜¯å…¬ç½‘å¯è®¿é—®çš„åœ°å€ï¼‰
   - **ä»¤ç‰Œ(Token)**: è‡ªå®šä¹‰å­—ç¬¦ä¸²ï¼Œä¸config.jsonä¸­çš„`wechat_mp_token`ä¿æŒä¸€è‡´
   - **æ¶ˆæ¯åŠ è§£å¯†å¯†é’¥(EncodingAESKey)**: ç‚¹å‡»"éšæœºç”Ÿæˆ"ï¼Œå¹¶å¤åˆ¶åˆ°config.jsonä¸­çš„`wechat_mp_aes_key`
   - **æ¶ˆæ¯åŠ è§£å¯†æ–¹å¼**: é€‰æ‹©"å®‰å…¨æ¨¡å¼"ï¼ˆæ¨èï¼‰

3. è®°å½•å¾®ä¿¡å…¬ä¼—å·çš„AppIDå’ŒAppSecretï¼Œå¡«å…¥config.jsonä¸­å¯¹åº”å­—æ®µ

### 3. é…ç½®IPç™½åå•

1. åœ¨"è®¾ç½®ä¸å¼€å‘" â†’ "åŸºæœ¬é…ç½®" â†’ "IPç™½åå•"ä¸­
2. æ·»åŠ æ‚¨æœåŠ¡å™¨çš„å…¬ç½‘IPåœ°å€
3. å¦‚æœ‰å¤šå°æœåŠ¡å™¨ï¼Œå…¨éƒ¨æ·»åŠ 

### 4. é…ç½®æ¶ˆæ¯ä¸èœå•

1. è¿›å…¥"è®¾ç½®ä¸å¼€å‘" â†’ "åŠŸèƒ½è®¾ç½®"
2. å¯ç”¨"è‡ªåŠ¨å›å¤"åŠŸèƒ½
3. å¯é€‰ï¼šé…ç½®è‡ªå®šä¹‰èœå•ï¼Œå¢åŠ ç”¨æˆ·äº¤äº’åŠŸèƒ½

## æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

### LinuxæœåŠ¡å™¨éƒ¨ç½²

#### ç¯å¢ƒå‡†å¤‡ï¼ˆCentOS 7ï¼‰

```bash
# å®‰è£…Pythonå’Œä¾èµ–
yum update -y
yum install -y python38 python38-devel python38-pip gcc make
yum install -y epel-release
yum install -y python-pillow
pip3 install --upgrade pip

# å®‰è£…é¡¹ç›®ä¾èµ–
cd /path/to/wehcat
pip3 install -r requirements.txt
```

#### ç¯å¢ƒå‡†å¤‡ï¼ˆUbuntu 18.04/20.04ï¼‰

```bash
# å®‰è£…Pythonå’Œä¾èµ–
apt update
apt install -y python3.8 python3.8-dev python3-pip python3-venv
apt install -y build-essential libssl-dev libffi-dev

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
python3 -m venv venv
source venv/bin/activate

# å®‰è£…é¡¹ç›®ä¾èµ–
cd /path/to/wehcat
pip install -r requirements.txt
```

#### ä½¿ç”¨systemdç®¡ç†æœåŠ¡

1. åˆ›å»ºæœåŠ¡æ–‡ä»¶ï¼š

```bash
sudo nano /etc/systemd/system/wechat-ai.service
```

2. æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```
[Unit]
Description=WeChat AI Assistant Service
After=network.target

[Service]
User=your-username
WorkingDirectory=/path/to/wehcat
ExecStart=/usr/bin/python3 app.py
Restart=on-failure
RestartSec=5
StandardOutput=syslog
StandardError=syslog
SyslogIdentifier=wechat-ai

[Install]
WantedBy=multi-user.target
```

3. å¯åŠ¨æœåŠ¡ï¼š

```bash
sudo systemctl daemon-reload
sudo systemctl enable wechat-ai
sudo systemctl start wechat-ai
sudo systemctl status wechat-ai
```

#### ä½¿ç”¨Nginxåå‘ä»£ç†ï¼ˆå¯é€‰ï¼‰

1. å®‰è£…Nginxï¼š

```bash
# CentOS
yum install -y nginx

# Ubuntu
apt install -y nginx
```

2. é…ç½®Nginxï¼š

```bash
sudo nano /etc/nginx/conf.d/wechat-ai.conf
```

3. æ·»åŠ é…ç½®ï¼š

```
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://127.0.0.1:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

4. é‡å¯Nginxï¼š

```bash
sudo nginx -t
sudo systemctl restart nginx
```

### WindowsæœåŠ¡å™¨éƒ¨ç½²

#### ç¯å¢ƒå‡†å¤‡

1. ä¸‹è½½å¹¶å®‰è£…[Python 3.8+](https://www.python.org/downloads/windows/)
2. å®‰è£…ä¾èµ–ï¼š

```cmd
cd C:\path\to\wehcat
pip install -r requirements.txt
```

#### é…ç½®é˜²ç«å¢™

1. æ‰“å¼€Windows Defenderé˜²ç«å¢™
2. æ·»åŠ å…¥ç«™è§„åˆ™ï¼Œå…è®¸80ç«¯å£ï¼ˆæˆ–æ‚¨é…ç½®çš„å…¶ä»–ç«¯å£ï¼‰

#### æ³¨å†Œä¸ºWindowsæœåŠ¡

1. å®‰è£…NSSMï¼ˆNon-Sucking Service Managerï¼‰ï¼š
   - ä¸‹è½½[NSSM](https://nssm.cc/download)
   - è§£å‹åˆ°ä»»æ„ç›®å½•

2. ä½¿ç”¨NSSMåˆ›å»ºæœåŠ¡ï¼š

```cmd
nssm.exe install WeChatAI
```

3. åœ¨å¼¹å‡ºçš„é…ç½®çª—å£ä¸­ï¼š
   - **Path**: é€‰æ‹©Pythonå®‰è£…è·¯å¾„ï¼ˆå¦‚`C:\Python38\python.exe`ï¼‰
   - **Startup directory**: é¡¹ç›®ç›®å½•ï¼ˆå¦‚`C:\path\to\wehcat`ï¼‰
   - **Arguments**: `app.py`
   - **è¯¦ç»†è®¾ç½®**: è®¾ç½®æœåŠ¡è‡ªåŠ¨å¯åŠ¨ã€å¤±è´¥æ—¶è‡ªåŠ¨é‡å¯ç­‰

4. ç®¡ç†æœåŠ¡ï¼š

```cmd
nssm.exe start WeChatAI
nssm.exe status WeChatAI
```

## ç¼–è¯‘æ‰“åŒ…æ•™ç¨‹

### ç¼–è¯‘å‡†å¤‡

1. å®‰è£…PyInstallerï¼š

```bash
pip install pyinstaller
```

2. ç¡®ä¿æ‰€æœ‰ä¾èµ–å·²å®‰è£…ï¼š

```bash
pip install -r requirements.txt
```

### Windowsç³»ç»Ÿç¼–è¯‘

1. åŸºæœ¬ç¼–è¯‘ï¼š

```cmd
pyinstaller --clean --onefile app.py
```

2. ä½¿ç”¨è§„èŒƒæ–‡ä»¶ï¼ˆæ¨èï¼‰ï¼š

```cmd
pyinstaller --clean wechat.spec
```

3. è‡ªå®šä¹‰å›¾æ ‡ç¼–è¯‘ï¼š

```cmd
pyinstaller --icon=app_icon.ico --clean --onefile app.py
```

### Linuxç³»ç»Ÿç¼–è¯‘

1. åŸºæœ¬ç¼–è¯‘ï¼š

```bash
pyinstaller --clean --onefile app.py
```

2. ä½¿ç”¨è§„èŒƒæ–‡ä»¶ï¼š

```bash
pyinstaller --clean wechat.spec
```

### è‡ªå®šä¹‰å›¾æ ‡è¯´æ˜

é¡¹ç›®æ”¯æŒè‡ªå®šä¹‰Windowsä»»åŠ¡æ å’Œç³»ç»Ÿæ‰˜ç›˜å›¾æ ‡ï¼š

1. å‡†å¤‡å›¾æ ‡æ–‡ä»¶ï¼š
   - å‡†å¤‡ä¸€ä¸ª.icoæ ¼å¼çš„å›¾æ ‡æ–‡ä»¶ï¼ˆæ¨èå°ºå¯¸ï¼š256x256ï¼‰
   - å°†å›¾æ ‡æ–‡ä»¶å‘½åä¸º`app_icon.ico`å¹¶æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•

2. è½¬æ¢å›¾æ ‡ï¼ˆå¦‚æœæœ‰é.icoæ ¼å¼å›¾åƒï¼‰ï¼š

```bash
python convert_icon.py your_image.png
```

3. ä¿®æ”¹å›¾æ ‡ä»£ç ï¼ˆå¯é€‰ï¼‰ï¼š
   - ç¼–è¾‘`app_icons.py`æ–‡ä»¶
   - ä¿®æ”¹`ICON_BASE64`å˜é‡ä¸ºæ–°å›¾æ ‡çš„Base64ç¼–ç 

4. åœ¨specæ–‡ä»¶ä¸­æŒ‡å®šå›¾æ ‡ï¼š
   - ç¼–è¾‘`wechat.spec`æ–‡ä»¶
   - æ‰¾åˆ°`exe = EXE(...)`éƒ¨åˆ†
   - ç¡®ä¿`icon='app_icon.ico'`æ­£ç¡®è®¾ç½®

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ä½¿ç”¨

1. å¯åŠ¨æœåŠ¡ï¼š

```bash
# Linux
python3 app.py

# Windows
python app.py
```

2. æœåŠ¡æˆåŠŸå¯åŠ¨åï¼Œä¼šåœ¨å‘½ä»¤è¡Œæ˜¾ç¤ºï¼š
   ```
   ======== å¾®ä¿¡AIåŠ©æ‰‹æœåŠ¡å¯åŠ¨ ========
   æœåŠ¡åœ°å€: 0.0.0.0:80
   è®¤è¯æ–¹å¼: compatible
   APIåŸºç¡€URL: https://your-api-url.com
   ä½¿ç”¨æ¨¡å‹: deepseek-r1
   ====================================
   ```

3. åœ¨å¾®ä¿¡å…¬ä¼—å·å‘é€æ¶ˆæ¯ï¼Œæœºå™¨äººä¼šè‡ªåŠ¨å›å¤

### ç®¡ç†å‘½ä»¤

- æŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼š
  ```bash
  # Linux
  systemctl status wechat-ai
  
  # Windows
  nssm status WeChatAI
  ```

- é‡å¯æœåŠ¡ï¼š
  ```bash
  # Linux
  systemctl restart wechat-ai
  
  # Windows
  nssm restart WeChatAI
  ```

### ç”¨æˆ·äº¤äº’

1. å…³æ³¨é…ç½®å¥½çš„å¾®ä¿¡å…¬ä¼—å·
2. å‘å…¬ä¼—å·å‘é€æ–‡æœ¬æ¶ˆæ¯
3. ç³»ç»Ÿä¼šè°ƒç”¨DeepSeek AIæ¨¡å‹å¤„ç†è¯·æ±‚å¹¶è¿”å›å›å¤
4. å¦‚æœå›å¤è¾ƒé•¿ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ†æ®µå‘é€

## é…ç½®è¯´æ˜

ä¸»è¦é…ç½®é¡¹ï¼ˆconfig.jsonï¼‰ï¼š

```json
{
  "model": "deepseek-r1",
  "open_ai_api_key": "æ‚¨çš„APIå¯†é’¥",
  "open_ai_api_base": "APIåŸºç¡€åœ°å€",
  "wechat_mp_token": "å¾®ä¿¡å…¬ä¼—å·Token",
  "wechat_mp_app_id": "å¾®ä¿¡å…¬ä¼—å·AppID",
  "wechat_mp_app_secret": "å¾®ä¿¡å…¬ä¼—å·AppSecret",
  "wechat_mp_aes_key": "æ¶ˆæ¯åŠ è§£å¯†å¯†é’¥",
  "wechat_mp_port": 80,
  "wechat_mp_address": "0.0.0.0"
}
```

## å¸¸è§é—®é¢˜

1. ç«¯å£è¢«å ç”¨
   - æ£€æŸ¥80ç«¯å£æ˜¯å¦è¢«å…¶ä»–ç¨‹åºå ç”¨
   - å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ç«¯å£å·

2. æ¶ˆæ¯å‘é€å¤±è´¥
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - ç¡®è®¤APIå¯†é’¥æ˜¯å¦æœ‰æ•ˆ
   - æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶æ’æŸ¥å…·ä½“åŸå› 

3. ç¨‹åºæ— æ³•å¯åŠ¨
   - æ£€æŸ¥Pythonç¯å¢ƒæ˜¯å¦æ­£ç¡®å®‰è£…
   - ç¡®è®¤æ‰€æœ‰ä¾èµ–åŒ…å·²å®‰è£…
   - æŸ¥çœ‹é”™è¯¯æ—¥å¿—å®šä½é—®é¢˜

4. å¾®ä¿¡å…¬ä¼—å·æœªæ”¶åˆ°å›å¤
   - ç¡®è®¤æœåŠ¡å™¨URLé…ç½®æ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥æœåŠ¡å™¨é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ç›¸åº”ç«¯å£
   - éªŒè¯Tokené…ç½®æ˜¯å¦ä¸€è‡´

5. å›å¤é€Ÿåº¦æ…¢
   - æ£€æŸ¥ç½‘ç»œè¿æ¥è´¨é‡
   - è€ƒè™‘è°ƒæ•´APIè¶…æ—¶è®¾ç½®
   - å¯èƒ½æ˜¯AIæ¨¡å‹å¤„ç†æ—¶é—´è¾ƒé•¿ï¼Œå±äºæ­£å¸¸ç°è±¡

## æ—¥å¿—è¯´æ˜

- æ—¥å¿—æ–‡ä»¶ä½äº `logs` ç›®å½•ä¸‹
- æŒ‰æ—¥æœŸè‡ªåŠ¨åˆ†å‰²æ—¥å¿—æ–‡ä»¶
- å¯é€šè¿‡é…ç½®æ–‡ä»¶è°ƒæ•´æ—¥å¿—çº§åˆ«

## æ›´æ–°è¯´æ˜

### v1.0.0
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- æ”¯æŒåŸºæœ¬çš„æ¶ˆæ¯æ”¶å‘åŠŸèƒ½
- é›†æˆDeepSeek AIæ¨¡å‹
- æ”¯æŒé•¿æ¶ˆæ¯è‡ªåŠ¨åˆ†æ®µ

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤Issueæˆ–è”ç³»ç®¡ç†å‘˜ã€‚

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ 
